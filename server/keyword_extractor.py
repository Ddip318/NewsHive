# keyword_extractor.py
"""
자연어 문장에서 핵심 키워드를 추출하는 함수.
- 기존 로직에 영향 없이 별도 파일로 관리
- 형태소 분석기(konlpy의 Okt 등) 또는 간단한 규칙 기반 추출 지원
- 외부 라이브러리 미설치 환경도 고려해 fallback 제공
"""

from typing import List

# 우선 konlpy가 있으면 사용하는 방식, 없으면 fallback
try:
    from konlpy.tag import Okt
    okt = Okt()
    # 불용어 리스트 (OKT에서도 활용)
    stopwords = set([
        '어떻게', '왜', '뭐', '무엇', '누구', '언제', '어디',
        '는', '가', '을', '를', '이', '에', '의', '도', '로', '으로', '에서', '부터', '까지',
        '그리고', '그러나', '하지만', '그래서', '그러면', '그런데', '또한', '또', '및', '등', '등등'
    ])
    def extract_keywords(text: str, top_k: int = 10) -> List[str]:
        # 명사만 추출 후, 길이 1 이상 & 불용어 제거
        nouns = okt.nouns(text)
        keywords = [n for n in nouns if len(n) > 1 and n not in stopwords]
        # 중복 제거 및 top_k개 반환
        keywords = list(dict.fromkeys(keywords))
        return keywords[:top_k]
except ImportError:
    import re
    # 불용어 리스트(필요시 확장)
    stopwords = set([
        '어떻게', '왜', '뭐', '무엇', '누구', '언제', '어디',
        '는', '가', '을', '를', '이', '가', '에', '의', '도', '로', '으로', '에서', '부터', '까지',
        '에게', '한테', '밖에', '마다', '까지', '처럼', '보다', '하고', '및', '과', '와', '든지', '이나', '나', '라도', '조차', '마저', '만큼', '씩', '밖에', '뿐', '이나마', '이나마', '커녕', '조차', '까지도', '이라도', '이라곤', '이라면', '이지만', '인데', '이고', '이며', '이자', '이어서', '이든', '이라든', '이란', '이랑', '이래서', '이래도', '이랬다', '이랬던', '이랬으면', '이랬으니', '이랬으니까', '이랬을까', '이랬을텐데', '이랬을지', '이랬으리라', '이랬으리니', '이랬으리만큼', '이랬으리만치', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도', '이랬으리만은', '이랬으리만도', '이랬으리만큼은', '이랬으리만치도',
        '그리고', '그러나', '하지만', '그래서', '그러면', '그런데', '또한', '또', '및', '등', '등등'
    ])
    def extract_keywords(text: str, top_k: int = 10) -> List[str]:
        # 한글/영문/숫자 단어 추출 (2글자 이상)
        candidates = re.findall(r'[가-힣]{2,}|[a-zA-Z0-9]{2,}', text)
        # 불용어/질문어 리스트
        stopwords = set([
            '어떻게', '왜', '뭐', '무엇', '누구', '언제', '어디',
            '는', '가', '을', '를', '이', '에', '의', '도', '로', '으로', '에서', '부터', '까지',
            '그리고', '그러나', '하지만', '그래서', '그러면', '그런데', '또한', '또', '및', '등', '등등'
        ])
        question_words = set(['어떻게', '왜', '뭐', '무엇', '누구', '언제', '어디', '될까', '되나', '되니', '되냐', '되나요', '되었나', '되었나요', '궁금', '알려줘', '알고싶', '싶다', '싶어요', '싶니', '싶나요', '있나요', '있니', '있나'])
        # 후보 중 불용어/질문어 제거 및 중복 제거
        filtered = [w for w in candidates if w not in stopwords and w not in question_words]
        filtered = list(dict.fromkeys(filtered))
        return filtered[:top_k]

if __name__ == "__main__":
    # 테스트용
    test_sent = "삼성전자 주가는 어떻게 돼?"
    print(extract_keywords(test_sent))
